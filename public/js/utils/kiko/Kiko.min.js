import Md5Con from"../../lib/authorization/md5.min.js";import generateAuthorization from"./../generateAuthorization.js";export default class Kiko{businessKey="admin";businessSecret="12878dd962115106db6d";constructor(e){var t=e&&e.businessKey,e=e&&e.businessSecret;void 0!==t&&(this.businessKey=t),void 0!==e&&(this.businessSecret=e)}async fetch(e,t={}){const s=(t.method||"GET").toUpperCase();var o="string"==typeof e?e:e&&e.url,i=t.body,r=(r=i&&i.password)&&Md5Con.md5(r),i=i&&Object.assign({},i,r&&{password:r}),r=generateAuthorization({path:o.split("?")[0],method:s,params:i,businessKey:this.businessKey,businessSecret:this.businessSecret}),o=localStorage.getItem(Kiko.getTokenName()),a=["GET","HEAD"].some(e=>e===s),n=new URLSearchParams(i).toString(),i=Object.assign({},t,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8",Authorization:r.authorization,"Authorization-Date":r.date,Token:o},body:!a&&n?n:null});let u=e;if(a)switch(typeof u){case"string":u=""+u+(n&&"?"+n);break;case"object":u.url=""+u.url+(n&&"?"+n)}t=await fetch(u,i),r=t.status;return t.ok&&200==r?await t.json():((o=new Error(t.statusText)).code=r,Promise.reject(o))}static getTokenName(){return"_login_token_"}}