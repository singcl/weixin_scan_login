import axios from"/js/lib/axios.min.js";const businessKey="admin",businessSecret="12878dd962115106db6d";function request(e){var{url:t,method:s="GET",data:n={},params:a={},headers:r={}}=e,o=localStorage.getItem("WxToken"),t=t.split("?"),i=t[0],t=Qs.parse(t[1]),i=generateAuthorization({businessKey:businessKey,businessSecret:businessSecret,path:i,method:s.toUpperCase(),params:Object.assign({},t,n,a)}),s=Object.assign({"Content-Type":"application/x-www-form-urlencoded",Authorization:i.authorization,"Authorization-Date":i.date,WxToken:o},r),t=Object.assign({},e,{headers:s});return axios(t)}function generateAuthorization({businessKey:e,businessSecret:t,path:s,method:n,params:a}){var r=getCSTDate(),a=Qs.stringify(sortByKey(a)),s=s+"|"+n.toUpperCase()+"|"+a+"|"+r;return{authorization:e+" "+CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA256(s,t)),date:r}}function sortByKey(s){return Object.keys(s).sort().reduce((e,t)=>(e[t]=s[t],e),{})}function getCSTDate(){var e=new Date;return e.getFullYear()+"-"+(10<=e.getMonth()+1?e.getMonth()+1:"0"+(e.getMonth()+1))+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())}export default request;